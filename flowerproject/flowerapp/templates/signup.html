<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Account â€” Bloom Heaven</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
    --forest:     #0d2818;
    --deep:       #081a10;
    --mid:        #1a4a2e;
    --leaf:       #2d7a4f;
    --mint:       #4aad72;
    --pale:       #a8d5b5;
    --cream:      #f5f0e8;
    --warm:       #e8dcc8;
    --gold:       #c9a84c;
    --text-light: #f0ede6;
    --text-muted: rgba(240,237,230,0.55);
}

html, body { height: 100%; }

body {
    font-family: 'DM Sans', sans-serif;
    background: var(--deep);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    position: relative;
    padding: 24px 0;
}

/* â”€â”€ Botanical background â”€â”€ */
.bg-canvas {
    position: fixed;
    inset: 0;
    overflow: hidden;
    z-index: 0;
}

.bg-canvas::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
        radial-gradient(ellipse 60% 50% at 15% 50%, rgba(45,122,79,.18) 0%, transparent 70%),
        radial-gradient(ellipse 40% 60% at 85% 20%, rgba(26,74,46,.25) 0%, transparent 70%),
        radial-gradient(ellipse 50% 40% at 70% 80%, rgba(13,40,24,.4) 0%, transparent 70%);
}

.leaf {
    position: absolute;
    opacity: 0;
    animation: floatLeaf linear infinite;
    pointer-events: none;
}

.leaf svg { display: block; }

@keyframes floatLeaf {
    0%   { transform: translateY(110vh) rotate(0deg) scale(0.8); opacity: 0; }
    5%   { opacity: 0.12; }
    90%  { opacity: 0.08; }
    100% { transform: translateY(-10vh) rotate(720deg) scale(1.1); opacity: 0; }
}

.bg-grid {
    position: absolute;
    inset: 0;
    background-image:
        linear-gradient(rgba(45,122,79,.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(45,122,79,.04) 1px, transparent 1px);
    background-size: 48px 48px;
}

/* â”€â”€ Split layout â”€â”€ */
.page-wrap {
    position: relative;
    z-index: 10;
    display: grid;
    grid-template-columns: 1fr 460px;
    width: min(960px, 96vw);
    border-radius: 24px;
    overflow: hidden;
    box-shadow:
        0 0 0 1px rgba(45,122,79,.2),
        0 40px 80px rgba(0,0,0,.6),
        0 0 120px rgba(45,122,79,.08);
    animation: fadeUp .8s cubic-bezier(.16,1,.3,1) both;
}

@keyframes fadeUp {
    from { opacity: 0; transform: translateY(32px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* â”€â”€ Left panel â”€â”€ */
.left-panel {
    background:
        linear-gradient(160deg, rgba(13,40,24,.95) 0%, rgba(8,26,16,.98) 100%);
    padding: 56px 48px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    position: relative;
    overflow: hidden;
    border-right: 1px solid rgba(45,122,79,.15);
}

.left-panel::before {
    content: '';
    position: absolute;
    top: -80px; right: -80px;
    width: 300px; height: 300px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(45,122,79,.12) 0%, transparent 70%);
    pointer-events: none;
}

.brand {
    display: flex;
    flex-direction: column;
    gap: 8px;
    animation: fadeUp .8s .1s cubic-bezier(.16,1,.3,1) both;
}

.brand-icon {
    font-size: 36px;
    line-height: 1;
    filter: drop-shadow(0 4px 12px rgba(74,173,114,.4));
}

.brand-name {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--text-light);
    letter-spacing: -.3px;
    line-height: 1.1;
}

.brand-name em {
    font-style: italic;
    color: var(--mint);
}

.brand-tagline {
    font-size: 12px;
    color: var(--text-muted);
    letter-spacing: .12em;
    text-transform: uppercase;
    margin-top: 4px;
}

.left-middle {
    animation: fadeUp .8s .2s cubic-bezier(.16,1,.3,1) both;
}

.left-headline {
    font-family: 'Playfair Display', serif;
    font-size: 38px;
    font-weight: 600;
    color: var(--text-light);
    line-height: 1.15;
    letter-spacing: -.5px;
    margin-bottom: 16px;
}

.left-headline span {
    color: var(--mint);
    font-style: italic;
}

.left-desc {
    font-size: 14px;
    color: var(--text-muted);
    line-height: 1.7;
    max-width: 280px;
}

.features {
    display: flex;
    flex-direction: column;
    gap: 12px;
    animation: fadeUp .8s .3s cubic-bezier(.16,1,.3,1) both;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 13px;
    color: var(--text-muted);
}

.feature-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--mint);
    flex-shrink: 0;
    box-shadow: 0 0 8px rgba(74,173,114,.5);
}

/* â”€â”€ Right panel (form) â”€â”€ */
.right-panel {
    background: var(--cream);
    padding: 44px 44px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    animation: fadeUp .8s .15s cubic-bezier(.16,1,.3,1) both;
}

.form-title {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--forest);
    letter-spacing: -.4px;
    margin-bottom: 6px;
}

.form-subtitle {
    font-size: 13px;
    color: #7a7060;
    margin-bottom: 28px;
}

.form-subtitle a {
    color: var(--leaf);
    text-decoration: none;
    font-weight: 500;
}

.form-subtitle a:hover { text-decoration: underline; }

/* Two-column row */
.field-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
}

.field {
    margin-bottom: 16px;
}

.field label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: .08em;
    text-transform: uppercase;
    color: #5a5248;
    margin-bottom: 7px;
}

.field input {
    width: 100%;
    padding: 13px 16px;
    background: #fff;
    border: 1.5px solid #ddd5c8;
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    color: var(--forest);
    outline: none;
    transition: border-color .2s, box-shadow .2s;
}

.field input::placeholder { color: #bbb3a8; }

.field input:focus {
    border-color: var(--leaf);
    box-shadow: 0 0 0 3px rgba(45,122,79,.1);
}

.field input.input-error {
    border-color: #c0392b;
    box-shadow: 0 0 0 3px rgba(192,57,43,.08);
}

/* Password strength bar */
.strength-wrap { margin-top: 8px; }

.strength-bar {
    display: flex;
    gap: 4px;
    margin-bottom: 4px;
}

.strength-bar span {
    flex: 1;
    height: 3px;
    border-radius: 99px;
    background: #e0d8ce;
    transition: background .3s;
}

.strength-bar span.weak   { background: #e05c5c; }
.strength-bar span.medium { background: var(--gold); }
.strength-bar span.strong { background: var(--mint); }

.strength-label {
    font-size: 11px;
    color: #9a9080;
    transition: color .3s;
}

.submit-btn {
    width: 100%;
    padding: 14px;
    background: var(--forest);
    color: var(--text-light);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    letter-spacing: .03em;
    transition: all .2s;
    margin-top: 4px;
    position: relative;
    overflow: hidden;
}

.submit-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(74,173,114,.15) 0%, transparent 60%);
    opacity: 0;
    transition: opacity .2s;
}

.submit-btn:hover { background: var(--mid); transform: translateY(-1px); box-shadow: 0 8px 20px rgba(13,40,24,.25); }
.submit-btn:hover::before { opacity: 1; }
.submit-btn:active { transform: translateY(0); }
.submit-btn:disabled { opacity: .6; cursor: not-allowed; transform: none; }

.divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 18px 0;
    color: #bbb3a8;
    font-size: 12px;
}
.divider::before,
.divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: #e0d8ce;
}

.google-btn {
    width: 100%;
    padding: 12px 16px;
    background: #fff;
    border: 1.5px solid #ddd5c8;
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: #3c3630;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all .2s;
}

.google-btn:hover { background: #f8f4ef; border-color: #c8bfb4; box-shadow: 0 2px 8px rgba(0,0,0,.06); }
.google-btn img { width: 18px; height: 18px; }

.terms {
    font-size: 11px;
    color: #9a9080;
    text-align: center;
    margin-top: 14px;
    line-height: 1.6;
}

.terms a { color: var(--leaf); text-decoration: none; }
.terms a:hover { text-decoration: underline; }

/* â”€â”€ Toast â”€â”€ */
#toast {
    position: fixed;
    bottom: 28px; left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--forest);
    color: var(--text-light);
    padding: 12px 24px;
    border-radius: 100px;
    font-size: 13px;
    font-weight: 500;
    font-family: 'DM Sans', sans-serif;
    opacity: 0;
    transition: all .35s cubic-bezier(.16,1,.3,1);
    z-index: 999;
    pointer-events: none;
    white-space: nowrap;
    border: 1px solid rgba(45,122,79,.3);
    box-shadow: 0 8px 32px rgba(0,0,0,.3);
}
#toast.show    { opacity: 1; transform: translateX(-50%) translateY(0); }
#toast.error   { background: #5c1a1a; border-color: rgba(192,57,43,.3); }
#toast.success { background: var(--mid); border-color: rgba(74,173,114,.3); }
</style>
</head>
<body>

<!-- Botanical background -->
<div class="bg-canvas">
    <div class="bg-grid"></div>
</div>

<!-- Floating leaves -->
<script>
    const leafShapes = [
        `<svg width="24" height="36" viewBox="0 0 24 36" fill="none"><path d="M12 0C12 0 0 8 0 20C0 28.837 5.373 36 12 36C18.627 36 24 28.837 24 20C24 8 12 0 12 0Z" fill="#2d7a4f"/></svg>`,
        `<svg width="20" height="32" viewBox="0 0 20 32" fill="none"><path d="M10 0C10 0 0 10 2 20C4 28 10 32 10 32C10 32 16 28 18 20C20 10 10 0 10 0Z" fill="#1a4a2e"/></svg>`,
        `<svg width="28" height="20" viewBox="0 0 28 20" fill="none"><ellipse cx="14" cy="10" rx="14" ry="10" fill="#4aad72"/></svg>`,
    ];
    const canvas = document.querySelector('.bg-canvas');
    for (let i = 0; i < 18; i++) {
        const leaf = document.createElement('div');
        leaf.className = 'leaf';
        leaf.innerHTML = leafShapes[i % leafShapes.length];
        leaf.style.cssText = `
            left: ${Math.random() * 100}%;
            animation-duration: ${12 + Math.random() * 20}s;
            animation-delay: ${-Math.random() * 25}s;
            transform: scale(${0.5 + Math.random() * 1.2});
        `;
        canvas.appendChild(leaf);
    }
</script>

<div class="page-wrap">
    <!-- Left branding panel -->
    <div class="left-panel">
        <div class="brand">
            <div class="brand-icon">ðŸŒ¿</div>
            <div class="brand-name">Bloom <em>Heaven</em></div>
            <div class="brand-tagline">Cherthala Â· Alappuzha Â· Kerala</div>
        </div>

        <div class="left-middle">
            <h2 class="left-headline">
                Join our<br>
                growing<br>
                <span>community</span>
            </h2>
            <p class="left-desc">
                Create your account and start ordering fresh plants from local growers across Cherthala Taluk.
            </p>
        </div>

        <div class="features">
            <div class="feature-item">
                <div class="feature-dot"></div>
                Free account, no hidden fees
            </div>
            <div class="feature-item">
                <div class="feature-dot"></div>
                Track your orders in real time
            </div>
            <div class="feature-item">
                <div class="feature-dot"></div>
                Exclusive deals for members
            </div>
        </div>
    </div>

    <!-- Right form panel -->
    <div class="right-panel">
        <h1 class="form-title">Create account</h1>
        <p class="form-subtitle">
            Already have one? <a href="/flowerapp/login/">Sign in</a>
        </p>

        <form id="signupForm">
            <div class="field-row">
                <div class="field">
                    <label>Username</label>
                    <input id="username" type="text" placeholder="e.g. john123" required autocomplete="username">
                </div>
                <div class="field">
                    <label>Email</label>
                    <input id="email" type="email" placeholder="you@email.com" required autocomplete="email">
                </div>
            </div>

            <div class="field">
                <label>Password</label>
                <input id="password" type="password" placeholder="Create a strong password" required autocomplete="new-password">
                <div class="strength-wrap">
                    <div class="strength-bar">
                        <span id="s1"></span><span id="s2"></span>
                        <span id="s3"></span><span id="s4"></span>
                    </div>
                    <div class="strength-label" id="strengthLabel"></div>
                </div>
            </div>

            <div class="field">
                <label>Confirm Password</label>
                <input id="password2" type="password" placeholder="Repeat your password" required autocomplete="new-password">
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">Create Account</button>
        </form>

        <div class="divider">or continue with</div>

        <button class="google-btn" onclick="handleGoogleLogin()">
            <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">
            Sign up with Google
        </button>

        <p class="terms">
            By creating an account you agree to our
            <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.
        </p>
    </div>
</div>

<div id="toast"></div>

<!-- Google SDK -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
window.onload = function() {
    google.accounts.id.initialize({
        client_id: '275756032838-2ip96oepiavveqjr2eu4o3famb6gmvdj.apps.googleusercontent.com',
        callback: handleGoogleCredential
    });
}

function handleGoogleLogin() {
    google.accounts.id.prompt();
}

async function handleGoogleCredential(response) {
    const token = response.credential;
    try {
        const res  = await fetch('/api/v1/auth/google/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token })
        });
        const data = await res.json();
        if (!res.ok) { showToast(data.error || 'Google sign-up failed', 'error'); return; }

        localStorage.setItem('access_token',  data.access);
        localStorage.setItem('refresh_token', data.refresh);

        showToast(`Welcome, ${data.name}! ðŸŒ¿`, 'success');
        setTimeout(() => { window.location.href = '/flowerapp/flowers/'; }, 1500);
    } catch (err) {
        showToast('Google sign-up failed', 'error');
    }
}

/* â”€â”€ Password strength â”€â”€ */
document.getElementById('password').addEventListener('input', function() {
    const val  = this.value;
    const bars = ['s1','s2','s3','s4'].map(id => document.getElementById(id));
    const label = document.getElementById('strengthLabel');

    bars.forEach(b => { b.className = ''; });

    let score = 0;
    if (val.length >= 6)  score++;
    if (val.length >= 10) score++;
    if (/[A-Z]/.test(val) && /[0-9]/.test(val)) score++;
    if (/[^A-Za-z0-9]/.test(val)) score++;

    const cls    = ['','weak','weak','medium','strong'];
    const labels = ['','Weak','Fair','Strong','Very strong'];
    const colors = ['','#e05c5c','#e05c5c','#c9a84c','#4aad72'];

    for (let i = 0; i < score; i++) bars[i].className = cls[score];
    label.textContent = val.length ? labels[score] : '';
    label.style.color = colors[score];
});

/* â”€â”€ Signup form â”€â”€ */
document.getElementById('signupForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const username  = document.getElementById('username').value.trim();
    const email     = document.getElementById('email').value.trim();
    const password  = document.getElementById('password').value;
    const password2 = document.getElementById('password2').value;
    const p2Input   = document.getElementById('password2');
    const submitBtn = document.getElementById('submitBtn');

    if (password !== password2) {
        p2Input.classList.add('input-error');
        showToast('Passwords do not match!', 'error');
        return;
    }
    p2Input.classList.remove('input-error');

    submitBtn.disabled    = true;
    submitBtn.textContent = 'Creating accountâ€¦';

    try {
        const res  = await fetch('flowerapp/api/v1/signup/', {
            method:  'POST',
            headers: { 'Content-Type': 'application/json' },
            body:    JSON.stringify({ username, email, password, password2 })
        });
        const data = await res.json();

        if (!res.ok) {
            const msg = data.username || data.email || data.password || 'Signup failed';
            showToast(Array.isArray(msg) ? msg[0] : msg, 'error');
            return;
        }

        localStorage.setItem('access_token',  data.access);
        localStorage.setItem('refresh_token', data.refresh);

        showToast(`Welcome, ${data.user.username}! ðŸŒ¿`, 'success');
        setTimeout(() => { window.location.href = '/flowerapp/flowers/'; }, 1500);

    } catch (err) {
        showToast('Signup failed. Please try again.', 'error');
    } finally {
        submitBtn.disabled    = false;
        submitBtn.textContent = 'Create Account';
    }
});

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className   = `show ${type}`;
    setTimeout(() => { toast.className = ''; }, 3500);
}
</script>
</body>
</html>